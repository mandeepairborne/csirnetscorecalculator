<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Response Analyzer</title>
    <style>
        /* Keep previous styles */
    </style>
</head>
<body>
    <div class="container">
        <h1>Student Response Analyzer</h1>
        <input type="text" id="urlInput" placeholder="Enter response sheet URL">
        <button onclick="fetchDetails()">Analyze Response</button>
        <div id="output"></div>
    </div>

    <script>
        async function fetchDetails() {
            const urlInput = document.getElementById('urlInput');
            const output = document.getElementById('output');
            output.innerHTML = '<div class="loading">Loading...</div>';

            try {
                const proxy = 'https://cors-anywhere.herokuapp.com/';
                const response = await fetch(proxy + urlInput.value);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                // Improved roll number extraction
                const getRollNo = () => {
                    const rollNoPattern = /Roll No\s*:?\s*(\d+)/i;
                    const cells = Array.from(doc.querySelectorAll('td'));
                    
                    const rollNoCell = cells.find(td => {
                        const match = td.textContent.match(rollNoPattern);
                        return match && match[1];
                    });

                    return rollNoCell ? rollNoCell.textContent.match(rollNoPattern)[1] : 'N/A';
                };

                // Other details extraction remains same
                const student = {
                    rollNo: getRollNo(),
                    regNo: getDetail('Registration No'),
                    name: getDetail('Candidate Name'),
                    module: getDetail('Module Name'),
                    examDate: getDetail('Exam Date'),
                    batch: getDetail('Exam Batch')
                };

                // Rest of the code remains same
                
            } catch (error) {
                // Error handling remains same
            }
        }

        // Add this helper function if not already present
        function getDetail(label) {
            const cells = Array.from(document.querySelectorAll('td'));
            const cell = cells.find(td => {
                const regex = new RegExp(`^${label}\\s*:?`, 'i');
                return regex.test(td.textContent.trim());
            });
            return cell ? cell.nextElementSibling.textContent.trim() : 'N/A';
        }
    </script>
</body>
</html>
