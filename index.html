<!DOCTYPE html>
<html>
<head>
    <title>CSIR-NET Physics Score Calculator</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .candidate-info { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .candidate-info table { width: 100%; }
        .candidate-info td { padding: 5px 0; }
        input[type="text"] { width: 500px; padding: 8px; margin-right: 10px; }
        button { padding: 8px 16px; background: #4CAF50; color: white; border: none; cursor: pointer; }
        #result { margin-top: 20px; padding: 15px; background: #f8f8f8; }
        .error { color: red; }
        .score-breakdown { margin-top: 15px; }
        .part-score { margin: 10px 0; padding: 10px; border-left: 3px solid #4CAF50; }
    </style>
</head>
<body>
    <h1>CSIR-NET Physics Score Calculator</h1>
    <input type="text" id="url" placeholder="Paste response sheet URL here">
    <button onclick="calculateScore()">Calculate Score</button>
    <div id="result"></div>

    <script>
        const CORRECT_ANSWERS = {
    "705101": "2",
    "705102": "4",
    "705103": "4",
    "705104": "1",
    "705105": "1",
    "705106": "2",
    "705107": "4",
    "705108": "2",
    "705109": "4",
    "705110": "1",
    "705111": "2",
    "705112": "3",
    "705113": "4",
    "705114": "1",
    "705115": "2",
    "705116": "4",
    "705117": "4",
    "705118": "2",
    "705119": "2",
    "705120": "2",
    "705121": "4",
    "705122": "3",
    "705123": "3",
    "705124": "2",
    "705125": "1",
    "705126": "2",
    "705127": "2",
    "705128": "3",
    "705129": "3",
    "705130": "2",
    "705131": "3",
    "705132": "1",
    "705133": "2",
    "705134": "2",
    "705135": "1",
    "705136": "3",
    "705137": "3",
    "705138": "4",
    "705139": "2",
    "705140": "4",
    "705141": "2",
    "705142": "2",
    "705143": "3",
    "705144": "4",
    "705145": "1",
    "705146": "4",
    "705147": "2",
    "705148": "1",
    "705149": "4",
    "705150": "3",
    "705151": "1",
    "705152": "4",
    "705153": "1",
    "705154": "1",
    "705155": "3",
    "705156": "4",
    "705157": "4",
    "705158": "3",
    "705159": "4",
    "705160": "4",
    "705161": "2",
    "705162": "4",
    "705163": "1",
    "705164": "4",
    "705165": "3",
    "705166": "3",
    "705167": "1",
    "705168": "1",
    "705169": "4",
    "705170": "1",
    "705171": "2",
    "705172": "4",
    "705173": "2",
    "705174": "1",
    "705175": "2"
};

        async function calculateScore() {
            const url = document.getElementById('url').value;
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = "Connecting to server...";

            try {
                // 1. Fetch and parse HTML
                const response = await fetch(`https://cors-anywhere.herokuapp.com/${url}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                // 2. Extract Candidate Details
                const candidateDetails = {
                    rollNo: doc.querySelector('td:contains("Roll No") + td')?.textContent.trim() || 'Not found',
                    regNo: doc.querySelector('td:contains("Registration No") + td')?.textContent.trim() || 'Not found',
                    name: doc.querySelector('td:contains("Candidate Name") + td')?.textContent.trim() || 'Not found',
                    examDate: doc.querySelector('td:contains("Exam Date") + td')?.textContent.trim() || 'Not found'
                };

                // 3. Display Candidate Info
                resultDiv.innerHTML = `
                    <div class="candidate-info">
                        <h3>Candidate Details</h3>
                        <table>
                            <tr><td>Roll No:</td><td>${candidateDetails.rollNo}</td></tr>
                            <tr><td>Registration No:</td><td>${candidateDetails.regNo}</td></tr>
                            <tr><td>Name:</td><td>${candidateDetails.name}</td></tr>
                            <tr><td>Exam Date:</td><td>${candidateDetails.examDate}</td></tr>
                        </table>
                    </div>
                    <div>Processing questions...</div>
                `;

                // 4. Process Questions
                const questions = doc.querySelectorAll('fieldset table');
                let totalScore = 0;
                const partStats = {
                    A: { correct: 0, incorrect: 0, unattempted: 0, marks: 2, negative: 0.5 },
                    B: { correct: 0, incorrect: 0, unattempted: 0, marks: 3.5, negative: 0.875 },
                    C: { correct: 0, incorrect: 0, unattempted: 0, marks: 5, negative: 1.25 }
                };

                questions.forEach(question => {
                    const qidMatch = question.textContent.match(/Question ID\s+(\d+)/);
                    if (!qidMatch) return;
                    
                    const qid = qidMatch[1];
                    const correctAnswer = CORRECT_ANSWERS[qid];
                    if (!correctAnswer) return;

                    // Get selected answer
                    const selectedOption = question.querySelector('input[type="radio"]:checked + span');
                    const userAnswer = selectedOption?.textContent.match(/\d+/)?.[0];

                    // Determine part
                    const qNum = parseInt(qid.slice(4));
                    let part;
                    if (qNum <= 120) part = 'A';
                    else if (qNum <= 145) part = 'B';
                    else part = 'C';

                    // Calculate score
                    if (!userAnswer) {
                        partStats[part].unattempted++;
                    } else if (userAnswer === correctAnswer) {
                        partStats[part].correct++;
                        totalScore += partStats[part].marks;
                    } else {
                        partStats[part].incorrect++;
                        totalScore -= partStats[part].negative;
                    }
                });

                // 5. Display Results
                resultDiv.innerHTML += `
                    <div class="score-breakdown">
                        <h3>Total Score: ${totalScore.toFixed(2)}</h3>
                        ${Object.entries(partStats).map(([part, stats]) => `
                            <div class="part-score">
                                <h4>Part ${part}</h4>
                                <p>Correct: ${stats.correct} × ${stats.marks} = +${(stats.correct * stats.marks).toFixed(2)}</p>
                                <p>Incorrect: ${stats.incorrect} × -${stats.negative.toFixed(3)} = -${(stats.incorrect * stats.negative).toFixed(2)}</p>
                                <p>Unattempted: ${stats.unattempted}</p>
                            </div>
                        `).join('')}
                    </div>
                `;

            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        Error: ${error.message}<br>
                        Possible issues:<br>
                        1. CORS restrictions (try using CORS proxy)<br>
                        2. Invalid response sheet URL<br>
                        3. Network issues
                    </div>
                `;
                console.error('Error Details:', error);
            }
        }
    </script>
</body>
</html>
